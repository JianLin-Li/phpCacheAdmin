{% import 'partials/key_type_badge.twig' as key_badge %}

<div class="mb-5 flex items-center gap-2">
    <span>Type {{ key_badge.key_type(type) }}</span>

    {% if ttl %}
        <span>
            TTL
            {{ include('components/badge.twig', {
                text: ttl == -1 ? 'Doesn\'t expire' : ttl,
                pill: true,
                class: 'uppercase font-bold',
                bg: 'bg-slate-500',
            }) }}
        </span>
    {% endif %}

    {% if encode_fn %}
        <span>Encoded with {{ include('components/badge.twig', {text: encode_fn, pill: true, class: 'uppercase font-bold', bg: 'bg-blue-500'}) }}</span>
        {% set encode_url = '&encoder=' ~ encode_fn %}
    {% endif %}

    {% if formatted == true %}
        {{ include('components/badge.twig', {text: 'Formatted', pill: true, class: 'uppercase font-bold', bg: 'bg-blue-500'}) }}
    {% endif %}

    <a href="{{ export_url }}" class="inline-flex items-center gap-1 font-semibold text-gray-500 hover:text-gray-700">
        {{ svg('export') }} Export
    </a>

    <a href="{{ delete_url }}" class="inline-flex items-center gap-1 font-semibold text-red-500 hover:text-red-700"
       onclick="return confirm('Are you sure you want to remove this item?');">
        {{ svg('trash') }} Delete
    </a>
</div>

{% if value is iterable %}
    {{ include('components/button.twig', {
        text: 'Add another value',
        icon: 'open',
        link: add_subkey_url,
        btn_green: true,
        class: 'mb-2',
    }) }}

    {% for item in value %}
        {% if type == 'set' %}
            {% set param_name = 'member' %}
            {% set title = '' %}
        {% elseif type == 'list' %}
            {% set param_name = 'index' %}
            {% set title = 'Index' %}
        {% elseif type == 'zset' %}
            {% set param_name = 'range' %}
            {% set title = 'Score' %}
        {% elseif type == 'hash' %}
            {% set param_name = 'hash_key' %}
            {% set title = 'Key' %}
        {% endif %}

        <div class="mb-5 rounded bg-white shadow-lg">
            <div class="flex justify-between overflow-y-auto border-b px-4 py-1.5">
                <span>
                    {% if type != 'set' %}
                        {{ title }} {{ include('components/badge.twig', {text: item.score, pill: true, class: 'font-bold', bg: 'bg-slate-400'}) }}
                    {% endif %}

                    {% if item.encode_fn %}
                        <span>
                            Encoded with
                            {{ include('components/badge.twig', {text: item.encode_fn, pill: true, class: 'uppercase font-bold', bg: 'bg-blue-500'}) }}
                        </span>

                        {% set item_encode_url = '&encoder=' ~ item.encode_fn %}
                    {% endif %}

                    {% if item.formatted == true %}
                        {{ include('components/badge.twig', {text: 'Formatted', pill: true, class: 'uppercase font-bold', bg: 'bg-blue-500'}) }}
                    {% endif %}
                </span>

                <div>
                    <a href="{{ edit_url }}&{{ param_name }}={{ item.key ~ item_encode_url }}" class="text-gray-500 hover:text-gray-700 font-semibold mr-3 inline-block mr-3 [&>svg]:align-[-0.05rem]">
                        {{ svg('edit', 13) }} Edit
                    </a>
                    <a href="{{ deletesub_url }}&{{ param_name }}={{ item.key }}" class="text-red-500 hover:text-red-700 font-semibold inline-block [&>svg]:align-[-0.05rem]"
                       onclick="return confirm('Are you sure you want to remove this item?');">
                        {{ svg('trash', 13) }} Delete
                    </a>
                </div>
            </div>

            <div class="overflow-y-auto p-4">
                {{ item.value|raw }}
            </div>
        </div>
    {% endfor %}

    {{ paginator|raw }}
{% else %}
    <a href="{{ edit_url ~ encode_url }}" class="mr-3 mb-3 inline-block font-semibold text-gray-500 hover:text-gray-700">
        {{ svg('edit', 13) }} Edit
    </a>
    <div class="rounded bg-white shadow-lg">
        <div class="overflow-y-auto p-4">
            {{ value|raw }}
        </div>
    </div>
{% endif %}
